parameters:
  artifactSource: 'true'
  cache: 'false'
  version: ''

steps:
- script: mkdir build && cd build && cmake -G "Visual Studio 15 2017 Win64" --config Release -DCITRA_USE_BUNDLED_QT=1 -DCITRA_USE_BUNDLED_SDL2=1 -DCITRA_ENABLE_COMPATIBILITY_REPORTING=${COMPAT} -DENABLE_COMPATIBILITY_LIST_DOWNLOAD=ON -DUSE_DISCORD_PRESENCE=ON  -DENABLE_MF=ON -DENABLE_FFMPEG_VIDEO_DUMPER=ON .. && cd ..
  displayName: 'Configure CMake'
- task: MSBuild@1
  displayName: 'Build'
  inputs:
    solution: 'build/citra.sln'
    maximumCpuCount: true
    configuration: release
- task: PowerShell@2
  displayName: 'Package Artifacts'
  inputs:
    targetType: 'filePath'
    filePath: './.ci/scripts/windows/upload.ps1'
    arguments: '$(BuildName)'
- publish: artifacts
  artifact: 'citra-$(BuildName)-windows-msvc'
  displayName: 'Upload Artifacts'
