trigger:
- master

resources:
  containers:
  - container: linux_fresh
    # options: -v "$HOME/.ccache":/root/.ccache
    image: citraemu/build-environments:linux-fresh
  - container: linux_frozen
    # options: -v "$HOME/.ccache":/root/.ccache
    image: citraemu/build-environments:linux-frozen
  - container: linux_mingw
    # options: -v "$HOME/.ccache":/root/.ccache
    image: citraemu/build-environments:linux-mingw
  - container: linux_clang_format
    image: citraemu/build-environments:linux-clang-format
  - container: linux_transifex
    image: citraemu/build-environments:linux-transifex

jobs:
- job: LinuxContainerBuilds
  pool:
    vmImage: 'ubuntu-16.04'

  container: $[ variables['containerResource'] ]

  strategy:
    matrix:
      linux-fresh:
        containerResource: linux_fresh
      linux-frozen:
        containerResource: linux_frozen
      linux-mingw:
        containerResource: linux_mingw
      clang-format:
        containerResource: linux_clang_format

  steps:
  - bash: git submodule update --init --recursive
    displayName: 'Fetch submodules'
  - bash: /bin/bash -ex ./.travis/${AGENT_JOBNAME}/docker.sh
    displayName: 'Build Citra'

- job: macOSNativeBuilds
  pool:
    vmImage: 'macOS-10.13'

  steps:
  - bash: ./.travis/macos/deps.sh
    displayName: 'Install dependencies'
  - bash: git submodule update --init --recursive
    displayName: 'Fetch submodules'
  - bash: sudo xcode-select -s /Applications/Xcode_10.1.app/Contents/Developer
    displayName: 'Select XCode version'
  - bash: ./.travis/macos/build.sh
    displayName: 'Build Citra'
