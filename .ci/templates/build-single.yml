parameters:
  artifactSource: 'true'
  archiveArtifact: 'true'
  cache: 'false'
  version: ''

steps:
- ${{ if eq(parameters.cache, 'true') }}:
  - task: Cache@2
    inputs:
      key: citra | $(BuildName) | $(BuildSuffix) | $(Build.SourceVersion)
      path: '$(System.DefaultWorkingDirectory)/ccache'
      cacheHitVar: 'CACHE_RESTORED'
      restoreKeys: citra | $(BuildName) | $(BuildSuffix)
- bash: ./.ci/scripts/$(ScriptFolder)/docker.sh
  displayName: 'Build'
  env:
    CCACHE_DIR: $(System.DefaultWorkingDirectory)/ccache
- ${{ if eq(parameters.archiveArtifact, 'true') }}:
  - bash: RELEASE_NAME=$(BuildName) ./.ci/scripts/$(ScriptFolder)/upload.sh
    displayName: 'Package Artifacts'
  - publish: artifacts
    artifact: 'citra-$(BuildName)-$(BuildSuffix)'
    displayName: 'Upload Artifacts'
