parameters:
  artifactSource: 'true'
  cache: 'false'
  version: ''

steps:
- ${{ if eq(parameters.cache, 'true') }}:
  - task: CacheBeta@0
    displayName: 'Cache Build System'
    inputs:
      key: citra-v1-$(BuildName)-$(BuildSuffix)-$(CacheSuffix)
      path: $(System.DefaultWorkingDirectory)/ccache
      cacheHitVar: CACHE_RESTORED
- script: ./.ci/scripts/$(ScriptFolder)/docker.sh
  displayName: 'Build'
  env:
    CCACHE_DIR: $(System.DefaultWorkingDirectory)/ccache
- script: RELEASE_NAME=$(BuildName) ./.ci/scripts/$(ScriptFolder)/upload.sh
  displayName: 'Package Artifacts'
- publish: artifacts
  artifact: 'citra-$(BuildName)-$(BuildSuffix)'
  displayName: 'Upload Artifacts'
